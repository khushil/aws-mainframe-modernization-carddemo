# VL-007 Authentication Flow Verification
# Validates the 12-step authentication flow described in SECURITY-MODEL.md Section 2.1
# against actual source code in app/cbl/COSGN00C.cbl

source_file: app/cbl/COSGN00C.cbl
total_lines: 261
section_validated: "2.1 Authentication Flow"

steps:
  - step: 1
    description: "Terminal sends User ID + Password"
    doc_claim: "Enter User ID + Password"
    code_reference: "COSGN00C.cbl:110-115 EXEC CICS RECEIVE MAP"
    status: VERIFIED
    notes: "BMS map COSGN0A receives USERIDI and PASSWDI fields"

  - step: 2
    description: "Input validation - empty fields"
    doc_claim: "Not explicitly shown in sequence diagram"
    code_reference: "COSGN00C.cbl:117-130"
    status: VERIFIED
    notes: "EVALUATE checks for SPACES or LOW-VALUES on both fields"

  - step: 3
    description: "UPPER-CASE transform"
    doc_claim: "Line 132-136: UPPER-CASE transform"
    code_reference: "COSGN00C.cbl:132-136"
    status: VERIFIED
    notes: "FUNCTION UPPER-CASE applied to both USERIDI and PASSWDI"

  - step: 4
    description: "VSAM file READ"
    doc_claim: "EXEC CICS READ RIDFLD(WS-USER-ID) at Lines 211-219"
    code_reference: "COSGN00C.cbl:211-219"
    status: VERIFIED
    notes: "DATASET(WS-USRSEC-FILE) INTO(SEC-USER-DATA) RIDFLD(WS-USER-ID)"

  - step: 5
    description: "User not found path (RESP=13)"
    doc_claim: "NOTFND response, Line 249"
    code_reference: "COSGN00C.cbl:247-251"
    status: VERIFIED
    notes: "WHEN 13 -> 'User not found. Try again ...' TO WS-MESSAGE"

  - step: 6
    description: "User found path (RESP=0)"
    doc_claim: "SEC-USER-DATA (80 bytes) returned"
    code_reference: "COSGN00C.cbl:221-222"
    status: VERIFIED
    notes: "WHEN 0 begins password comparison"

  - step: 7
    description: "Password comparison"
    doc_claim: "Line 223: IF SEC-USR-PWD = WS-USER-PWD"
    code_reference: "COSGN00C.cbl:223"
    status: VERIFIED
    notes: "Plain-text string comparison, exact match"

  - step: 8
    description: "Password mismatch path"
    doc_claim: "Line 242: 'Wrong Password. Try again...'"
    code_reference: "COSGN00C.cbl:242-243"
    status: VERIFIED
    notes: "Different error message than user-not-found enables enumeration"

  - step: 9
    description: "Session establishment on success"
    doc_claim: "Lines 226-227: MOVE to COMMAREA"
    code_reference: "COSGN00C.cbl:224-228"
    status: VERIFIED
    notes: "Moves TRANID, PGMNAME, USER-ID, USER-TYPE, PGM-CONTEXT to COMMAREA"

  - step: 10
    description: "Admin role routing"
    doc_claim: "SEC-USR-TYPE = 'A' routes to COADM01C at Line 230-234"
    code_reference: "COSGN00C.cbl:230-234"
    status: VERIFIED
    notes: "IF CDEMO-USRTYP-ADMIN -> XCTL PROGRAM('COADM01C') COMMAREA(CARDDEMO-COMMAREA)"

  - step: 11
    description: "User role routing"
    doc_claim: "SEC-USR-TYPE = 'U' routes to COMEN01C at Line 236-239"
    code_reference: "COSGN00C.cbl:235-239"
    status: VERIFIED
    notes: "ELSE -> XCTL PROGRAM('COMEN01C') COMMAREA(CARDDEMO-COMMAREA)"

  - step: 12
    description: "Other error path"
    doc_claim: "Not shown in sequence diagram"
    code_reference: "COSGN00C.cbl:252-256"
    status: VERIFIED
    notes: "WHEN OTHER -> 'Unable to verify the User ...' (additional error path not in doc)"

verification_summary:
  steps_verified: 12
  steps_failed: 0
  accuracy: "100%"
  notes: >
    All 12 authentication steps verified line-by-line against COSGN00C.cbl.
    The sequence diagram in the document accurately represents the code flow.
    Line numbers are correct. Error messages are exact string matches.
    One minor observation: the WHEN OTHER error path (line 252) is not shown
    in the sequence diagram but this is an acceptable simplification.
