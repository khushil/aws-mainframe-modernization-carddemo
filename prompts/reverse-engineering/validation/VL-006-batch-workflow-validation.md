# VL-006: Batch Workflow Validation

## Prompt

```xml
<context>
  <project>CardDemo - AWS mainframe credit card processing demonstration application</project>

  <role>
    <persona>Validation Analyst specializing in JCL batch workflow and COBOL batch program verification</persona>

    <validation_expertise>
      <skill>JCL syntax and structure verification: JOB cards, EXEC PGM= statements, DD statements, PROC invocations, condition codes</skill>
      <skill>Batch program cross-referencing: verifying EXEC PGM= values against actual COBOL program filenames in app/cbl/</skill>
      <skill>DD statement validation: confirming DSN references, DISP parameters, and dataset allocations match actual JCL content</skill>
      <skill>Job dependency graph verification: confirming DAG edges correspond to real data or control flow dependencies</skill>
      <skill>Shell script analysis: verifying batch orchestration scripts accurately described in documentation</skill>
      <skill>File extension sensitivity: detecting case-sensitive extension differences (.cbl vs .CBL, .jcl vs .JCL)</skill>
      <skill>Hallucination detection in batch contexts: fabricated job names, invented step names, phantom DD statements</skill>
      <skill>COBOL batch program pattern verification: OPEN/READ/WRITE/CLOSE sequences, file status handling, return codes</skill>
      <skill>Completeness auditing: ensuring every JCL file and every batch program is accounted for in documentation</skill>
      <skill>Mermaid diagram validation: verifying flowchart DAG nodes match real jobs and edges reflect actual dependencies</skill>
    </validation_expertise>

    <carddemo_batch_context>
      CardDemo has 38 JCL files in app/jcl/ and 12 batch COBOL programs (CB* prefix) in app/cbl/.
      The JCL files have mixed-case extensions: 33 use .jcl (lowercase) and 5 use .JCL (uppercase).
      Two batch programs use uppercase .CBL extension: CBSTM03A.CBL and CBSTM03B.CBL.
      Three shell scripts in scripts/ orchestrate batch workflows: run_full_batch.sh,
      run_interest_calc.sh, and run_posting.sh.
      The documentation under validation is docs/reverse-engineering/05-specialized/BATCH-WORKFLOWS.md,
      generated by RE-006.
    </carddemo_batch_context>

    <mindset>
      Batch workflows are the backbone of mainframe operations. A single missed JCL file, an incorrect
      EXEC PGM= reference, or a wrong dependency edge in the DAG can cascade into fundamentally flawed
      modernization plans. The validator must verify every claim against actual source: read each JCL
      file to confirm step names and DD statements, check each EXEC PGM= against the real program
      inventory, and ensure the dependency graph reflects genuine data flow. Pay special attention to
      the two .CBL files (CBSTM03A.CBL, CBSTM03B.CBL) which are frequently omitted due to their
      non-standard extension, and to the five .JCL files which may be miscounted or missed.
    </mindset>
  </role>

  <objective>
    <primary_goal>
      Validate the accuracy, completeness, and factual correctness of
      docs/reverse-engineering/05-specialized/BATCH-WORKFLOWS.md by cross-referencing every claim
      against the actual JCL files in app/jcl/, batch COBOL programs in app/cbl/, and orchestration
      scripts in scripts/.
    </primary_goal>

    <validation_scope>
      <scope_item>JCL file inventory completeness: all 38 files listed and described</scope_item>
      <scope_item>EXEC PGM= accuracy: program names in documentation match actual COBOL program filenames</scope_item>
      <scope_item>DD statement verification: input/output dataset names and dispositions match actual JCL content</scope_item>
      <scope_item>Batch program coverage: all 12 CB* programs documented with correct descriptions</scope_item>
      <scope_item>CBSTM03A.CBL and CBSTM03B.CBL inclusion: these .CBL-extension files are often missed</scope_item>
      <scope_item>Batch dependency DAG accuracy: nodes represent real jobs, edges represent real dependencies</scope_item>
      <scope_item>Shell script descriptions: run_full_batch.sh, run_interest_calc.sh, run_posting.sh correctly documented</scope_item>
      <scope_item>Job categorization: JCL files properly grouped by function (definition, load, processing, reporting, utility)</scope_item>
      <scope_item>Condition code documentation: COND= parameters correctly interpreted and documented</scope_item>
      <scope_item>Mermaid diagram validity: flowchart syntax correct, nodes match real entities</scope_item>
    </validation_scope>

    <success_criteria>
      <criterion>Every JCL filename in the documentation matches a real file in app/jcl/ (no hallucinated filenames)</criterion>
      <criterion>Every EXEC PGM= value in documentation matches an actual program name</criterion>
      <criterion>No JCL file from the ground truth list is missing from the documentation</criterion>
      <criterion>No batch program from the ground truth list is missing from the documentation</criterion>
      <criterion>DD statement names and DSN values verified against actual JCL content for at least 50% of jobs</criterion>
      <criterion>Dependency DAG has no phantom edges (dependencies that do not exist in reality)</criterion>
      <criterion>Shell scripts described accurately reflect their actual content</criterion>
    </success_criteria>

    <integration>
      This validation prompt runs in Phase 4 (parallel with VL-005, VL-007, VL-008) and depends on
      VL-001 and VL-002 for foundational entity and data model verification. Its results feed into
      VL-000 (Cross-Document Consistency) as the final validation step.
    </integration>
  </objective>

  <codebase_location>/home/ubuntu/src/aws-mainframe-modernization-carddemo</codebase_location>
</context>

<ground_truth>
  <description>
    Canonical inventory of batch-related assets verified directly from the source tree.
    Every item below has been confirmed to exist. The validator MUST use this as the
    authoritative reference when checking documentation completeness and accuracy.
  </description>

  <jcl_files count="38" location="app/jcl/">
    <file name="ACCTFILE.jcl" extension=".jcl" />
    <file name="CARDFILE.jcl" extension=".jcl" />
    <file name="CBADMCDJ.jcl" extension=".jcl" />
    <file name="CBEXPORT.jcl" extension=".jcl" />
    <file name="CBIMPORT.jcl" extension=".jcl" />
    <file name="CLOSEFIL.jcl" extension=".jcl" />
    <file name="COMBTRAN.jcl" extension=".jcl" />
    <file name="CREASTMT.JCL" extension=".JCL" />
    <file name="CUSTFILE.jcl" extension=".jcl" />
    <file name="DALYREJS.jcl" extension=".jcl" />
    <file name="DEFCUST.jcl" extension=".jcl" />
    <file name="DEFGDGB.jcl" extension=".jcl" />
    <file name="DEFGDGD.jcl" extension=".jcl" />
    <file name="DISCGRP.jcl" extension=".jcl" />
    <file name="DUSRSECJ.jcl" extension=".jcl" />
    <file name="ESDSRRDS.jcl" extension=".jcl" />
    <file name="FTPJCL.JCL" extension=".JCL" />
    <file name="INTCALC.jcl" extension=".jcl" />
    <file name="INTRDRJ1.JCL" extension=".JCL" />
    <file name="INTRDRJ2.JCL" extension=".JCL" />
    <file name="OPENFIL.jcl" extension=".jcl" />
    <file name="POSTTRAN.jcl" extension=".jcl" />
    <file name="PRTCATBL.jcl" extension=".jcl" />
    <file name="READACCT.jcl" extension=".jcl" />
    <file name="READCARD.jcl" extension=".jcl" />
    <file name="READCUST.jcl" extension=".jcl" />
    <file name="READXREF.jcl" extension=".jcl" />
    <file name="REPTFILE.jcl" extension=".jcl" />
    <file name="TCATBALF.jcl" extension=".jcl" />
    <file name="TRANBKP.jcl" extension=".jcl" />
    <file name="TRANCATG.jcl" extension=".jcl" />
    <file name="TRANFILE.jcl" extension=".jcl" />
    <file name="TRANIDX.jcl" extension=".jcl" />
    <file name="TRANREPT.jcl" extension=".jcl" />
    <file name="TRANTYPE.jcl" extension=".jcl" />
    <file name="TXT2PDF1.JCL" extension=".JCL" />
    <file name="WAITSTEP.jcl" extension=".jcl" />
    <file name="XREFFILE.jcl" extension=".jcl" />
    <extension_breakdown>
      <lowercase_jcl count="33">ACCTFILE, CARDFILE, CBADMCDJ, CBEXPORT, CBIMPORT, CLOSEFIL, COMBTRAN, CUSTFILE, DALYREJS, DEFCUST, DEFGDGB, DEFGDGD, DISCGRP, DUSRSECJ, ESDSRRDS, INTCALC, OPENFIL, POSTTRAN, PRTCATBL, READACCT, READCARD, READCUST, READXREF, REPTFILE, TCATBALF, TRANBKP, TRANCATG, TRANFILE, TRANIDX, TRANREPT, TRANTYPE, WAITSTEP, XREFFILE</lowercase_jcl>
      <uppercase_JCL count="5">CREASTMT, FTPJCL, INTRDRJ1, INTRDRJ2, TXT2PDF1</uppercase_JCL>
    </extension_breakdown>
  </jcl_files>

  <batch_programs count="12" location="app/cbl/">
    <program name="CBACT01C.cbl" extension=".cbl" purpose="Account file creation/maintenance" />
    <program name="CBACT02C.cbl" extension=".cbl" purpose="Account file update" />
    <program name="CBACT03C.cbl" extension=".cbl" purpose="Account file delete" />
    <program name="CBACT04C.cbl" extension=".cbl" purpose="Account file reporting" />
    <program name="CBCUS01C.cbl" extension=".cbl" purpose="Customer file maintenance" />
    <program name="CBEXPORT.cbl" extension=".cbl" purpose="Data export with EBCDIC conversion" />
    <program name="CBIMPORT.cbl" extension=".cbl" purpose="Data import from external sources" />
    <program name="CBSTM03A.CBL" extension=".CBL" purpose="Statement generation (part A)" />
    <program name="CBSTM03B.CBL" extension=".CBL" purpose="Statement generation (part B)" />
    <program name="CBTRN01C.cbl" extension=".cbl" purpose="Transaction posting" />
    <program name="CBTRN02C.cbl" extension=".cbl" purpose="Interest calculation" />
    <program name="CBTRN03C.cbl" extension=".cbl" purpose="Statement generation (main)" />
    <extension_note>
      CBSTM03A.CBL and CBSTM03B.CBL use uppercase .CBL extension. These are frequently
      omitted or missed by documentation generators due to case-sensitive glob patterns
      that only match .cbl. Flag their absence as a CRITICAL finding.
    </extension_note>
  </batch_programs>

  <orchestration_scripts location="scripts/">
    <script name="run_full_batch.sh" purpose="Complete batch cycle: refresh data, post transactions, calculate interest" />
    <script name="run_interest_calc.sh" purpose="Daily interest calculations only" />
    <script name="run_posting.sh" purpose="Transaction posting only" />
  </orchestration_scripts>

  <overall_codebase_counts>
    <count asset="COBOL programs" location="app/cbl/" value="31" note="29 .cbl + 2 .CBL" />
    <count asset="Copybooks" location="app/cpy/" value="30" note="29 .cpy + 1 .CPY (COSTM01.CPY)" />
    <count asset="BMS mapsets" location="app/bms/" value="17" note="All .bms lowercase" />
    <count asset="JCL files" location="app/jcl/" value="38" note="33 .jcl + 5 .JCL" />
  </overall_codebase_counts>

  <known_hallucinations>
    <hallucination id="1">
      <claim>CVCAR00Y.cpy referenced as card copybook</claim>
      <reality>Actual file is CVCRD01Y.cpy</reality>
      <affected_prompts>RE-001, RE-002</affected_prompts>
    </hallucination>
    <hallucination id="2">
      <claim>COUSR00Y.cpy referenced as user copybook</claim>
      <reality>Actual file is CSUSR01Y.cpy</reality>
      <affected_prompts>RE-001, RE-002, RE-007</affected_prompts>
    </hallucination>
    <hallucination id="3">
      <claim>39 COBOL programs claimed in some documentation</claim>
      <reality>Actual count is 31 (29 .cbl + 2 .CBL)</reality>
      <affected_prompts>RE-001, CLAUDE.md</affected_prompts>
    </hallucination>
    <hallucination id="4">
      <claim>41 copybooks claimed</claim>
      <reality>Actual count is 30 (29 .cpy + 1 .CPY)</reality>
      <affected_prompts>RE-001, CLAUDE.md</affected_prompts>
    </hallucination>
    <hallucination id="5">
      <claim>21 BMS mapsets claimed</claim>
      <reality>Actual count is 17</reality>
      <affected_prompts>CLAUDE.md</affected_prompts>
    </hallucination>
  </known_hallucinations>
</ground_truth>

<validation_methodology>
  <phase name="1_inventory_completeness">
    <description>Verify all 38 JCL files and all 12 batch programs are listed in the documentation</description>
    <steps>
      <step>Read docs/reverse-engineering/05-specialized/BATCH-WORKFLOWS.md</step>
      <step>Extract every JCL filename mentioned in the documentation</step>
      <step>Compare extracted list against the 38-file ground truth list above</step>
      <step>Identify any JCL files present in ground truth but missing from documentation (completeness gap)</step>
      <step>Identify any JCL filenames in documentation that do not exist in ground truth (hallucination)</step>
      <step>Repeat for batch programs: extract all CB* program names from documentation</step>
      <step>Compare against the 12-program ground truth list</step>
      <step>Specifically check for CBSTM03A.CBL and CBSTM03B.CBL — flag absence as CRITICAL</step>
      <step>Verify extension accuracy: .jcl vs .JCL and .cbl vs .CBL correctly noted where relevant</step>
    </steps>
    <output_artifact>.work/reverse-engineering/validation/vl-006/inventory-check.yaml</output_artifact>
  </phase>

  <phase name="2_exec_pgm_verification">
    <description>Verify every EXEC PGM= reference in the documentation against actual JCL content</description>
    <steps>
      <step>For each JCL file documented with an EXEC PGM= statement, read the actual JCL file</step>
      <step>Extract all EXEC PGM= values from the actual JCL content</step>
      <step>Compare documented PGM= values against actual PGM= values</step>
      <step>Check that documented program names correspond to real programs in app/cbl/</step>
      <step>Flag any EXEC PGM= value in documentation that does not appear in the actual JCL (hallucination)</step>
      <step>Flag any EXEC PGM= value in actual JCL that is omitted from documentation (completeness gap)</step>
      <step>Note utility programs (IDCAMS, IEFBR14, SORT, etc.) that are system utilities, not CardDemo programs</step>
    </steps>
    <output_artifact>.work/reverse-engineering/validation/vl-006/exec-pgm-check.yaml</output_artifact>
  </phase>

  <phase name="3_dd_statement_verification">
    <description>Verify DD statement details against actual JCL content for a representative sample</description>
    <steps>
      <step>Select at least 19 JCL files (50% of 38) for detailed DD statement verification</step>
      <step>Prioritize core processing JCL: POSTTRAN, INTCALC, CREASTMT, CBEXPORT, CBIMPORT, ACCTFILE, CARDFILE, CUSTFILE, TRANFILE, XREFFILE</step>
      <step>For each selected file, read the actual JCL and list all DD statements</step>
      <step>Compare documented DD names, DSN values, and DISP parameters against actual JCL content</step>
      <step>Flag any DD statement in documentation that does not exist in the actual JCL (hallucination)</step>
      <step>Flag any significant DD statement in actual JCL omitted from documentation (completeness gap)</step>
      <step>Verify SYSOUT, SYSIN, STEPLIB descriptions are accurate</step>
    </steps>
    <output_artifact>.work/reverse-engineering/validation/vl-006/dd-statement-check.yaml</output_artifact>
  </phase>

  <phase name="4_dependency_dag_verification">
    <description>Verify the batch dependency DAG (Directed Acyclic Graph) is accurate</description>
    <steps>
      <step>Extract all nodes from the Mermaid dependency diagram in the documentation</step>
      <step>Verify each node corresponds to a real JCL file or batch process</step>
      <step>Extract all edges (dependencies) from the diagram</step>
      <step>For each edge A -> B, verify that B genuinely depends on A by checking:
        - B reads a file that A creates or updates
        - B's JCL references output datasets from A
        - The orchestration scripts enforce this ordering
      </step>
      <step>Check for missing dependencies: are there real data dependencies not shown in the DAG?</step>
      <step>Check for phantom dependencies: are there edges that do not correspond to real data or control flow?</step>
      <step>Verify DAG is acyclic (no circular dependencies)</step>
      <step>Verify critical paths are identified: file definition -> data load -> processing -> reporting</step>
    </steps>
    <output_artifact>.work/reverse-engineering/validation/vl-006/dependency-dag-check.yaml</output_artifact>
  </phase>

  <phase name="5_script_verification">
    <description>Verify shell script descriptions against actual script content</description>
    <steps>
      <step>Read scripts/run_full_batch.sh and compare documentation description against actual content</step>
      <step>Read scripts/run_interest_calc.sh and compare documentation description against actual content</step>
      <step>Read scripts/run_posting.sh and compare documentation description against actual content</step>
      <step>Verify documented script purposes match actual script behavior</step>
      <step>Verify documented script invocation sequences match actual command sequences in scripts</step>
      <step>Check if scripts reference specific JCL files or programs and verify those references</step>
      <step>Flag any script behavior described in documentation that does not match actual script content</step>
    </steps>
    <output_artifact>.work/reverse-engineering/validation/vl-006/script-check.yaml</output_artifact>
  </phase>

  <phase name="6_report_generation">
    <description>Compile findings into the final validation report</description>
    <steps>
      <step>Aggregate all findings from Phases 1-5</step>
      <step>Classify each finding by severity: Critical, Major, Minor</step>
      <step>Score each category according to the scoring rubric</step>
      <step>Calculate weighted total score</step>
      <step>Determine verdict: PASS (100), FAIL (less than 100)</step>
      <step>Compile hallucination inventory with specific source references</step>
      <step>Compile completeness gaps table</step>
      <step>Write actionable recommendations for remediation</step>
      <step>Write final report to docs/reverse-engineering/validation/VL-006-batch-workflow-report.md</step>
    </steps>
    <output_artifact>docs/reverse-engineering/validation/VL-006-batch-workflow-report.md</output_artifact>
  </phase>
</validation_methodology>

<scoring_rubric>
  <category name="Source Reference Accuracy" weight="35" severity="Critical">
    <description>Every file:line citation and EXEC PGM= reference verified against actual source</description>
    <scoring_guidance>
      <score range="90-100">All EXEC PGM= values correct, all JCL filenames match reality, all DD statement citations verified</score>
      <score range="70-89">1-3 minor inaccuracies in references (e.g., wrong step name but correct program)</score>
      <score range="50-69">4-6 inaccuracies including at least one fabricated EXEC PGM= or phantom JCL filename</score>
      <score range="30-49">7+ inaccuracies or multiple fabricated references</score>
      <score range="0-29">Pervasive fabrication of JCL content, step names, or program references</score>
    </scoring_guidance>
  </category>

  <category name="Factual Accuracy" weight="25" severity="Critical">
    <description>Job purposes, DD statement descriptions, condition code interpretations, and program behaviors match reality</description>
    <scoring_guidance>
      <score range="90-100">Job purposes accurate, DD statements correctly described, condition codes properly interpreted</score>
      <score range="70-89">Minor inaccuracies in job purpose descriptions or DD statement characterizations</score>
      <score range="50-69">Several incorrect job descriptions or mischaracterized DD statements</score>
      <score range="30-49">Fundamental misunderstandings of job purposes or batch program behavior</score>
      <score range="0-29">Documentation describes jobs that bear little resemblance to actual JCL content</score>
    </scoring_guidance>
  </category>

  <category name="Completeness" weight="20" severity="Major">
    <description>All 38 JCL files, all 12 batch programs, and all 3 orchestration scripts covered</description>
    <scoring_guidance>
      <score range="90-100">All 38 JCL files, all 12 batch programs (including CBSTM03A.CBL and CBSTM03B.CBL), and all 3 scripts documented</score>
      <score range="70-89">1-3 JCL files or 1 batch program missing; scripts partially covered</score>
      <score range="50-69">4-8 JCL files missing or 2-3 batch programs missing; CBSTM03A/B omitted</score>
      <score range="30-49">More than 8 JCL files missing or more than 3 batch programs missing</score>
      <score range="0-29">Less than half of JCL files or batch programs documented</score>
    </scoring_guidance>
  </category>

  <category name="Quantitative Accuracy" weight="10" severity="Major">
    <description>File counts, step counts, and numeric claims are correct</description>
    <scoring_guidance>
      <score range="90-100">JCL count = 38, batch program count = 12, extension breakdowns correct</score>
      <score range="70-89">Counts off by 1-2 or extension breakdown slightly inaccurate</score>
      <score range="50-69">Counts off by 3-5 or extension breakdown significantly wrong</score>
      <score range="30-49">Counts off by more than 5 or fundamental miscounting</score>
      <score range="0-29">Counts are fabricated or wildly inaccurate</score>
    </scoring_guidance>
  </category>

  <category name="Documentation Quality" weight="10" severity="Minor">
    <description>Mermaid syntax valid, markdown well-formed, DAG diagram readable, tables consistent</description>
    <scoring_guidance>
      <score range="90-100">All Mermaid diagrams render correctly, markdown well-structured, tables complete</score>
      <score range="70-89">Minor Mermaid syntax issues or formatting inconsistencies</score>
      <score range="50-69">Several broken diagrams or poorly structured sections</score>
      <score range="30-49">Most diagrams broken or documentation structure unclear</score>
      <score range="0-29">Documentation is unreadable or fundamentally malformed</score>
    </scoring_guidance>
  </category>

  <verdict_thresholds>
    <threshold score_min="100" score_max="100" verdict="PASS" meaning="Documentation is reliable for downstream use in modernization planning" />
    <threshold score_min="0" score_max="99" verdict="FAIL" meaning="Documentation is unreliable and must be regenerated with RE-006" />
  </verdict_thresholds>

  <finding_severity_levels>
    <level name="Critical">Hallucinated JCL filenames, fabricated EXEC PGM= values, invented DD statements, phantom dependency edges — causes incorrect modernization decisions</level>
    <level name="Major">Missing JCL files or batch programs in inventory, incomplete DD statement coverage, missing orchestration script descriptions — causes gaps in modernization planning</level>
    <level name="Minor">Formatting issues, broken Mermaid syntax, unclear job descriptions, inconsistent table formatting — causes friction but not errors</level>
  </finding_severity_levels>
</scoring_rubric>

<output_specification>
  <report_file>docs/reverse-engineering/validation/VL-006-batch-workflow-report.md</report_file>
  <working_directory>.work/reverse-engineering/validation/vl-006/</working_directory>

  <report_template>
```markdown
# Validation Report: Batch Workflow Analysis (BATCH-WORKFLOWS.md)

## Verdict: [PASS|FAIL] — Score: [NN]/100

## Score Breakdown

| Category | Weight | Score | Weighted |
|----------|--------|-------|----------|
| Source Reference Accuracy | 35% | NN/100 | NN.N |
| Factual Accuracy | 25% | NN/100 | NN.N |
| Completeness | 20% | NN/100 | NN.N |
| Quantitative Accuracy | 10% | NN/100 | NN.N |
| Documentation Quality | 10% | NN/100 | NN.N |
| **Total** | **100%** | | **NN.N** |

## Critical Findings

### CF-001: [Title]
- **Claim in documentation**: [exact quote]
- **Reality from source**: [what the actual JCL/program shows]
- **Source file**: [app/jcl/FILE.jcl or app/cbl/PROGRAM.cbl]
- **Impact**: [how this affects modernization decisions]

[... more critical findings]

## Major Findings

### MF-001: [Title]
- **Description**: [what is missing or incorrect]
- **Expected**: [what should be present based on ground truth]
- **Impact**: [how this affects documentation reliability]

[... more major findings]

## Minor Findings

### mf-001: [Title]
- **Description**: [formatting or quality issue]
- **Recommendation**: [how to fix]

[... more minor findings]

## Hallucination Inventory

| # | Claim in Documentation | Reality (from source) | Source File | Severity |
|---|----------------------|----------------------|-------------|----------|
| 1 | ... | ... | ... | Critical |

## JCL Completeness Check

| # | JCL File | Extension | Documented? | Description Accurate? | Notes |
|---|----------|-----------|-------------|----------------------|-------|
| 1 | ACCTFILE.jcl | .jcl | Yes/No | Yes/No/Partial | ... |
| 2 | CARDFILE.jcl | .jcl | Yes/No | Yes/No/Partial | ... |
[... all 38 files]

## Batch Program Completeness Check

| # | Program | Extension | Documented? | Description Accurate? | Notes |
|---|---------|-----------|-------------|----------------------|-------|
| 1 | CBACT01C.cbl | .cbl | Yes/No | Yes/No/Partial | ... |
[... all 12 programs]

## Script Verification

| Script | Documented? | Description Accurate? | Notes |
|--------|-------------|----------------------|-------|
| run_full_batch.sh | Yes/No | Yes/No/Partial | ... |
| run_interest_calc.sh | Yes/No | Yes/No/Partial | ... |
| run_posting.sh | Yes/No | Yes/No/Partial | ... |

## Dependency DAG Verification

### Nodes Verified
| Node | Exists in Source? | Correctly Described? |
|------|------------------|---------------------|
| ... | Yes/No | Yes/No |

### Edges Verified
| Edge (From -> To) | Dependency Type | Verified? | Evidence |
|-------------------|----------------|-----------|----------|
| ... | Data/Sequence/Conditional | Yes/No | ... |

## Recommendations

1. [Specific, actionable recommendation for remediation]
2. [...]

## Remediation Manifest
| ID | Finding | Target File | Location | Current (Wrong) | Required (Correct) | Source Evidence | Remediation Action | RE Prompt |
|----|---------|-------------|----------|-----------------|--------------------|-----------------|--------------------|-----------|
| R-001 | [finding] | [doc path] | [section/line] | [wrong] | [correct] | [source:line] | [fix] | [RE-NNN] |
### Remediation Instructions
For each row: (1) Read target at location, (2) Verify wrong value, (3) Replace with correct, (4) Re-validate
### Affected RE Prompts
[List RE prompts needing re-execution]
```
  </report_template>
</output_specification>

<foundational_principles>
  <principle id="1">Every EXEC PGM= value in documentation MUST be verified against the actual JCL file — read the source, do not trust the documentation</principle>
  <principle id="2">DD statement names and DSN values MUST be cross-referenced against actual JCL content — fabricated DD statements are a critical hallucination</principle>
  <principle id="3">The 38-file JCL inventory is canonical: 33 lowercase .jcl + 5 uppercase .JCL — any deviation in count or filenames is an error</principle>
  <principle id="4">The 12-program batch inventory is canonical: 10 lowercase .cbl + 2 uppercase .CBL (CBSTM03A.CBL, CBSTM03B.CBL) — absence of the .CBL files is CRITICAL</principle>
  <principle id="5">Dependency DAG edges must reflect genuine data flow: Job B depends on Job A only if B reads a file that A creates or modifies</principle>
  <principle id="6">Shell scripts in scripts/ are orchestration artifacts that define real workflow sequences — their documented behavior must match actual script content line by line</principle>
  <principle id="7">System utility programs (IDCAMS, IEFBR14, SORT, IEBGENER) are NOT CardDemo programs — documentation should distinguish between utility and application program references</principle>
  <principle id="8">Case sensitivity in file extensions matters: .jcl is not .JCL, .cbl is not .CBL — the validator must verify extension accuracy where the documentation makes extension claims</principle>
</foundational_principles>

<critical_reminders>
  <reminder id="1">ALWAYS read the actual JCL file before validating any claim about its content — never validate from memory or assumption</reminder>
  <reminder id="2">CBSTM03A.CBL and CBSTM03B.CBL are the most commonly missed batch programs due to their uppercase .CBL extension — check for their presence FIRST</reminder>
  <reminder id="3">The five .JCL files (CREASTMT.JCL, FTPJCL.JCL, INTRDRJ1.JCL, INTRDRJ2.JCL, TXT2PDF1.JCL) are often miscounted or missed — verify each one explicitly</reminder>
  <reminder id="4">JCL comments (lines starting with //*) are NOT executable statements — do not confuse commented-out steps with active steps</reminder>
  <reminder id="5">EXEC PGM= values in JCL may reference the program name without the file extension — e.g., PGM=CBTRN01C refers to CBTRN01C.cbl</reminder>
  <reminder id="6">Some JCL files may use EXEC PROC= instead of EXEC PGM= — both forms must be documented correctly</reminder>
  <reminder id="7">DD DUMMY and DD DSN=NULLFILE are valid placeholders — their presence in JCL is intentional, not an error</reminder>
  <reminder id="8">The dependency DAG should be acyclic — if the documentation shows circular dependencies, this is a critical error</reminder>
  <reminder id="9">Condition code semantics: COND=(0,NE) means "skip if any prior RC != 0" and COND=(4,LT) means "skip if any prior RC < 4" — verify documentation interprets these correctly</reminder>
  <reminder id="10">Cross-reference batch program names against EXEC PGM= values in JCL files to verify the documented program-to-job mapping is accurate and complete</reminder>
</critical_reminders>

<context_compaction_survival>
  <work_tracking_directory>
    <path>.work/reverse-engineering/validation/vl-006/</path>
    <purpose>Persist validation progress to survive context window compaction</purpose>
  </work_tracking_directory>

  <progress_tracking_schema>
    <file>progress.yaml</file>
    <structure>
```yaml
validation_phase: "inventory_check|exec_pgm_check|dd_statement_check|dag_check|script_check|report_generation"
jcl_files_checked: ["ACCTFILE.jcl", "CARDFILE.jcl", ...]
jcl_files_remaining: []
batch_programs_checked: ["CBACT01C.cbl", ...]
batch_programs_remaining: []
scripts_checked: ["run_full_batch.sh", ...]
findings:
  critical: []
  major: []
  minor: []
scores:
  source_reference_accuracy: null
  factual_accuracy: null
  completeness: null
  quantitative_accuracy: null
  documentation_quality: null
artifacts_created:
  - path: "inventory-check.yaml"
    status: "complete|partial"
  - path: "exec-pgm-check.yaml"
    status: "complete|partial"
  - path: "dd-statement-check.yaml"
    status: "complete|partial"
  - path: "dependency-dag-check.yaml"
    status: "complete|partial"
  - path: "script-check.yaml"
    status: "complete|partial"
next_action: "Detailed next step"
last_updated: "ISO timestamp"
```
    </structure>
  </progress_tracking_schema>

  <resumption_protocol>
    <step>1. Read .work/reverse-engineering/validation/vl-006/progress.yaml</step>
    <step>2. Load completed check artifacts (inventory-check.yaml, exec-pgm-check.yaml, etc.)</step>
    <step>3. Resume from next_action without re-reading already-verified files</step>
    <step>4. Update progress.yaml after each JCL file or batch program verified</step>
  </resumption_protocol>
</context_compaction_survival>

<begin>
  <instruction>
    Check for existing progress:
    1. Read .work/reverse-engineering/validation/vl-006/progress.yaml if it exists
    2. If progress exists and validation_phase != "complete":
       - Load completed check artifacts
       - Resume from next_action
    3. If no progress or starting fresh:
       - Verify docs/reverse-engineering/05-specialized/BATCH-WORKFLOWS.md exists
       - If it does not exist, report: "Cannot validate — BATCH-WORKFLOWS.md not found. Run RE-006 first."
       - Begin with Phase 1: Inventory Completeness
       - Create initial progress.yaml
    4. Execute all 6 phases sequentially:
       - Phase 1: Inventory Completeness — check all 38 JCL files and 12 batch programs
       - Phase 2: EXEC PGM= Verification — verify program references against actual JCL
       - Phase 3: DD Statement Verification — sample at least 50% of JCL files for DD accuracy
       - Phase 4: Dependency DAG Verification — verify all nodes and edges in the DAG
       - Phase 5: Script Verification — verify run_full_batch.sh, run_interest_calc.sh, run_posting.sh
       - Phase 6: Report Generation — compile findings and write final report
    5. After completing each phase:
       - Update progress.yaml with detailed next_action
       - Write intermediate check artifacts immediately
    6. Write final report to docs/reverse-engineering/validation/VL-006-batch-workflow-report.md
  </instruction>
</begin>
```

## Usage

Execute this prompt with Claude Code to validate the Batch Workflow Analysis documentation generated by RE-006. The prompt will:

1. **Inventory Check** -- Verify all 38 JCL files and 12 batch programs are documented
2. **EXEC PGM= Verification** -- Cross-reference every program execution against actual JCL content
3. **DD Statement Verification** -- Validate dataset definitions against actual JCL for at least 50% of files
4. **Dependency DAG Verification** -- Confirm all nodes and edges in the dependency graph are real
5. **Script Verification** -- Validate orchestration script descriptions against actual script content
6. **Report Generation** -- Compile scored validation report with hallucination inventory

## Expected Output

| File | Description |
|------|-------------|
| `docs/reverse-engineering/validation/VL-006-batch-workflow-report.md` | Scored validation report with findings, hallucination inventory, and completeness checks |

Intermediate artifacts in `.work/reverse-engineering/validation/vl-006/`:

| File | Description |
|------|-------------|
| `progress.yaml` | Validation progress tracker for context compaction survival |
| `inventory-check.yaml` | Results of JCL and batch program inventory verification |
| `exec-pgm-check.yaml` | Results of EXEC PGM= cross-reference verification |
| `dd-statement-check.yaml` | Results of DD statement verification for sampled JCL files |
| `dependency-dag-check.yaml` | Results of dependency DAG node and edge verification |
| `script-check.yaml` | Results of orchestration script verification |

## Prerequisites

- RE-006 (Batch Workflow Analysis) must have been executed and `docs/reverse-engineering/05-specialized/BATCH-WORKFLOWS.md` must exist
- Access to source files: `app/jcl/` (38 JCL files), `app/cbl/` (batch programs), `scripts/` (orchestration scripts)

## Depends On

- **VL-001** (Domain Model Validation) -- foundational entity verification informs batch program context
- **VL-002** (Data Model Validation) -- data file definitions inform DD statement and dataset verification

This prompt runs in Phase 4 of the validation execution order, in parallel with VL-005, VL-007, and VL-008.

## Blocks

- **VL-000** (Cross-Document Consistency) -- cannot run until all individual validations including VL-006 are complete
